{
  "core":
    {
      "affinity":
        {
          "nodeAffinity":
            {
              "requiredDuringSchedulingIgnoredDuringExecution":
                {
                  "nodeSelectorTerms":
                    [
                      {
                        "matchExpressions":
                          [
                            {
                              "key": "omnistrate.com/managed-by",
                              "operator": "In",
                              "values": ["omnistrate"],
                            },
                            {
                              "key": "topology.kubernetes.io/region",
                              "operator": "In",
                              "values": ["$sys.deploymentCell.region"],
                            },
                            {
                              "key": "node.kubernetes.io/instance-type",
                              "operator": "In",
                              "values": ["$sys.compute.node.instanceType"],
                            },
                            {
                              "key": "omnistrate.com/resource",
                              "operator": "In",
                              "values": ["$sys.deployment.resourceID"],
                            },
                          ],
                      },
                    ],
                },
            },
        },
    },
  "database":
    {
      "internal":
        {
          "affinity":
            {
              "nodeAffinity":
                {
                  "requiredDuringSchedulingIgnoredDuringExecution":
                    {
                      "nodeSelectorTerms":
                        [
                          {
                            "matchExpressions":
                              [
                                {
                                  "key": "omnistrate.com/managed-by",
                                  "operator": "In",
                                  "values": ["omnistrate"],
                                },
                                {
                                  "key": "topology.kubernetes.io/region",
                                  "operator": "In",
                                  "values": ["$sys.deploymentCell.region"],
                                },
                                {
                                  "key": "node.kubernetes.io/instance-type",
                                  "operator": "In",
                                  "values": ["$sys.compute.node.instanceType"],
                                },
                                {
                                  "key": "omnistrate.com/resource",
                                  "operator": "In",
                                  "values": ["$sys.deployment.resourceID"],
                                },
                              ],
                          },
                        ],
                    },
                },
            },
        },
    },
  "exporter":
    {
      "affinity":
        {
          "nodeAffinity":
            {
              "requiredDuringSchedulingIgnoredDuringExecution":
                {
                  "nodeSelectorTerms":
                    [
                      {
                        "matchExpressions":
                          [
                            {
                              "key": "omnistrate.com/managed-by",
                              "operator": "In",
                              "values": ["omnistrate"],
                            },
                            {
                              "key": "topology.kubernetes.io/region",
                              "operator": "In",
                              "values": ["$sys.deploymentCell.region"],
                            },
                            {
                              "key": "node.kubernetes.io/instance-type",
                              "operator": "In",
                              "values": ["$sys.compute.node.instanceType"],
                            },
                            {
                              "key": "omnistrate.com/resource",
                              "operator": "In",
                              "values": ["$sys.deployment.resourceID"],
                            },
                          ],
                      },
                    ],
                },
            },
        },
    },
  "expose":
    {
      "ingress":
        { "hosts": { "core": "$sys.network.externalClusterEndpoint" } },
      "tls":
        {
          "certSource": "secret",
          "secret":
            { "secretName": "$sys.deployment.tlsServerCertificateSecretName" },
        },
      "type": "Ingress",
    },
  "jobservice":
    {
      "affinity":
        {
          "nodeAffinity":
            {
              "requiredDuringSchedulingIgnoredDuringExecution":
                {
                  "nodeSelectorTerms":
                    [
                      {
                        "matchExpressions":
                          [
                            {
                              "key": "omnistrate.com/managed-by",
                              "operator": "In",
                              "values": ["omnistrate"],
                            },
                            {
                              "key": "topology.kubernetes.io/region",
                              "operator": "In",
                              "values": ["$sys.deploymentCell.region"],
                            },
                            {
                              "key": "node.kubernetes.io/instance-type",
                              "operator": "In",
                              "values": ["$sys.compute.node.instanceType"],
                            },
                            {
                              "key": "omnistrate.com/resource",
                              "operator": "In",
                              "values": ["$sys.deployment.resourceID"],
                            },
                          ],
                      },
                    ],
                },
            },
        },
    },
  "persistence":
    {
      "persistenceVolumeClaim":
        {
          "database": { "storageClass": "gp2" },
          "redis": { "storageClass": "gp2" },
          "registry": { "storageClass": "gp2" },
          "trivy": { "storageClass": "gp2" },
        },
      "resourcePolicy": "",
    },
  "portal":
    {
      "affinity":
        {
          "nodeAffinity":
            {
              "requiredDuringSchedulingIgnoredDuringExecution":
                {
                  "nodeSelectorTerms":
                    [
                      {
                        "matchExpressions":
                          [
                            {
                              "key": "omnistrate.com/managed-by",
                              "operator": "In",
                              "values": ["omnistrate"],
                            },
                            {
                              "key": "topology.kubernetes.io/region",
                              "operator": "In",
                              "values": ["$sys.deploymentCell.region"],
                            },
                            {
                              "key": "node.kubernetes.io/instance-type",
                              "operator": "In",
                              "values": ["$sys.compute.node.instanceType"],
                            },
                            {
                              "key": "omnistrate.com/resource",
                              "operator": "In",
                              "values": ["$sys.deployment.resourceID"],
                            },
                          ],
                      },
                    ],
                },
            },
        },
    },
  "redis":
    {
      "internal":
        {
          "affinity":
            {
              "nodeAffinity":
                {
                  "requiredDuringSchedulingIgnoredDuringExecution":
                    {
                      "nodeSelectorTerms":
                        [
                          {
                            "matchExpressions":
                              [
                                {
                                  "key": "omnistrate.com/managed-by",
                                  "operator": "In",
                                  "values": ["omnistrate"],
                                },
                                {
                                  "key": "topology.kubernetes.io/region",
                                  "operator": "In",
                                  "values": ["$sys.deploymentCell.region"],
                                },
                                {
                                  "key": "node.kubernetes.io/instance-type",
                                  "operator": "In",
                                  "values": ["$sys.compute.node.instanceType"],
                                },
                                {
                                  "key": "omnistrate.com/resource",
                                  "operator": "In",
                                  "values": ["$sys.deployment.resourceID"],
                                },
                              ],
                          },
                        ],
                    },
                },
            },
        },
    },
  "nginx":
    {
      "affinity":
        {
          "nodeAffinity":
            {
              "requiredDuringSchedulingIgnoredDuringExecution":
                {
                  "nodeSelectorTerms":
                    [
                      {
                        "matchExpressions":
                          [
                            {
                              "key": "omnistrate.com/managed-by",
                              "operator": "In",
                              "values": ["omnistrate"],
                            },
                            {
                              "key": "topology.kubernetes.io/region",
                              "operator": "In",
                              "values": ["$sys.deploymentCell.region"],
                            },
                            {
                              "key": "node.kubernetes.io/instance-type",
                              "operator": "In",
                              "values": ["$sys.compute.node.instanceType"],
                            },
                            {
                              "key": "omnistrate.com/resource",
                              "operator": "In",
                              "values": ["$sys.deployment.resourceID"],
                            },
                          ],
                      },
                    ],
                },
            },
        },
    },
  "registry":
    {
      "affinity":
        {
          "nodeAffinity":
            {
              "requiredDuringSchedulingIgnoredDuringExecution":
                {
                  "nodeSelectorTerms":
                    [
                      {
                        "matchExpressions":
                          [
                            {
                              "key": "omnistrate.com/managed-by",
                              "operator": "In",
                              "values": ["omnistrate"],
                            },
                            {
                              "key": "topology.kubernetes.io/region",
                              "operator": "In",
                              "values": ["$sys.deploymentCell.region"],
                            },
                            {
                              "key": "node.kubernetes.io/instance-type",
                              "operator": "In",
                              "values": ["$sys.compute.node.instanceType"],
                            },
                            {
                              "key": "omnistrate.com/resource",
                              "operator": "In",
                              "values": ["$sys.deployment.resourceID"],
                            },
                          ],
                      },
                    ],
                },
            },
        },
    },
  "trivy": { "enabled": false },
}
